class Lindenmayer{constructor(){this.key="lindenmayer",this.name="Space Filling Curves",this.hilbert_curve={l_system:{axiom:"A",rules:[["A","-BF+AFA+FB-"],["B","+AF-BFB-FA+"]]},draw:{length:ball_size,angle:90}},this.gosper_curve={l_system:{axiom:"A",rules:[["A","A+BF++BF-FA--FAFA-BF+"],["B","-FA+BFBF++BF+FA--FA-B"]]},draw:{length:ball_size,angle:60}},this.sierpinski_arrowhead={l_system:{axiom:"AF",rules:[["A","BF+AF+B"],["B","AF-BF-A"]]},draw:{length:ball_size,angle:60}},this.curve=this.sierpinski_arrowhead,this.config={curve:{name:"Curve",value:null,input:{type:"createSelect",options:{hilbert_curve:"Hilbert Curve",gosper_curve:"Gosper Curve",sierpinski_arrowhead:"Sierpinski Arrowhead"}}},iterations:{name:"Iterations",value:null,input:{type:"createSlider",params:[1,7,3,1],class:"slider",displayValue:!0}},length:{name:"Line Length",value:null,input:{type:"createSlider",params:[1,50,10,.1],class:"slider",displayValue:!0}},rotate:{name:"Rotate",value:null,input:{type:"createSlider",params:[0,360,0,1],class:"slider",displayValue:!0}},reverse:{name:"Reverse",value:null,input:{type:"createCheckbox",attributes:[{type:"checkbox",checked:null}],params:[0,1,0],displayValue:!1}}},this.path=[]}draw(){var curve_type=document.querySelector("#pattern-controls > div:nth-child(1) > select").value;this.config.curve.value=curve_type,this.curve=this[curve_type],this.config.iterations.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(2) > input").value),this.curve.iterations=parseInt(this.config.iterations.value),this.config.length.value=parseFloat(document.querySelector("#pattern-controls > div:nth-child(3) > input").value),this.config.rotate.value=parseInt(document.querySelector("#pattern-controls > div:nth-child(4) > input").value),document.querySelector("#pattern-controls > div.pattern-control:nth-child(2) > span").innerHTML=this.config.iterations.value,document.querySelector("#pattern-controls > div.pattern-control:nth-child(3) > span").innerHTML=this.config.length.value.toFixed(1)+" "+units,document.querySelector("#pattern-controls > div.pattern-control:nth-child(4) > span").innerHTML=this.config.rotate.value+"Â°";let lindenmayer_string=this.curve.l_system.axiom;for(let i=0;i<this.curve.iterations;i++)lindenmayer_string=this.compose_lindenmayer_string(lindenmayer_string);let path=this.calc(lindenmayer_string,this.config.length.value);return this.path=path,path}calc(lindenmayer_string,segment_length){var path=new Array,pos=0;let x=0,y=0;for(var current_angle=0;pos<lindenmayer_string.length-1;){if("F"==lindenmayer_string[pos]){let x1=x+segment_length*Math.cos(radians(current_angle)),y1=y+segment_length*Math.sin(radians(current_angle));path.push([x1,y1]),x=x1,y=y1}else"+"==lindenmayer_string[pos]?current_angle+=this.curve.draw.angle:"-"==lindenmayer_string[pos]&&(current_angle-=this.curve.draw.angle);pos++}return path=this.translate_to_center(path),this.config.rotate.value>0&&(path=this.rotate_around_center(path),path=this.translate_to_center(path)),path}compose_lindenmayer_string(s){let outputstring="";for(let i=0;i<s.length;i++){let ismatch=0;for(let j=0;j<this.curve.l_system.rules.length;j++)if(s[i]==this.curve.l_system.rules[j][0]){outputstring+=this.curve.l_system.rules[j][1],ismatch=1;break}0==ismatch&&(outputstring+=s[i])}return outputstring}translate_to_center(path){const arrayColumn=(arr,n)=>arr.map(a=>a[n]);var x_coordinates=arrayColumn(path,0),x_min=Math.min(...x_coordinates),x_max=Math.max(...x_coordinates),x_range=x_max-x_min,y_coordinates=arrayColumn(path,1),y_min=Math.min(...y_coordinates),y_max=Math.max(...y_coordinates),y_range=y_max-y_min;return path.map((function(a){return[a[0]-x_min-(x_max-x_min)/2,a[1]-y_min-(y_max-y_min)/2]}))}rotate_around_center(path){var theta=radians(this.config.rotate.value);return path.map((function(a){var x=a[0],y=a[1];return[x*Math.cos(theta)-y*Math.sin(theta),x*Math.sin(theta)+y*Math.cos(theta)]}))}}